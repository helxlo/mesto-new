(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{oi:()=>f,o3:()=>H,kN:()=>b});var t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-3",headers:{authorization:"5c7e4a88-915b-41bd-ae8c-c3716164a1c9","Content-Type":"application/json"}},n=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function o(e){e.classList.add("popup_opened"),document.addEventListener("keydown",c)}function r(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",c)}function c(e){"Escape"===e.key&&r(document.querySelector(".popup_opened"))}var a=document.querySelector(".popup_type_areyousure");function u(e,t,n,o){var r=document.querySelector("#element").content.querySelector(".element").cloneNode(!0),c=e.name,a=e.link,u=e.owner._id,i=e._id,s=e.likes,l=b.dataset.id;r.querySelector(".element__title").textContent=c;var d=r.querySelector(".element__pic");d.src=a,d.alt=c;var p=r.querySelector(".element__like"),_=s.some((function(e){return e._id===l}));_&&p.classList.add("element__like_active");var f=r.querySelector(".element__counter");p.addEventListener("click",(function(){return n(i,p,f)})),f.textContent=s.length;var m=r.querySelector(".element__trash");return u===l&&(m.style.visibility="visible"),m.addEventListener("click",(function(){return t(i,r)})),d.addEventListener("click",(function(){return o(a,c)})),r}var i=function(e,t){o(a),H.dataset.id=e,t.dataset.id=e};function s(e,o,r){var c;o.classList.contains("element__like_active")?(c=e,fetch("".concat(t.baseUrl,"/cards/likes/").concat(c),{method:"DELETE",headers:t.headers}).then(n)).then((function(e){r.textContent=e.likes.length,o.classList.remove("element__like_active")})).catch(f):function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then(n)}(e).then((function(e){r.textContent=e.likes.length,o.classList.add("element__like_active")})).catch(f)}var l=function(e,t,n){t.classList.remove(n.inputErrorClass);var o=e.querySelector(".".concat(t.id,"-error"));o.textContent="",o.classList.remove(n.errorClass)},d=function(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0},p=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):d(t,n)};function _(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){l(e,r,t),p(n,o,t)}))}var f=function(e){console.log(e)},m=document.querySelectorAll(".popup"),v=document.querySelector(".profile__name"),y=document.querySelector(".profile__description"),h=document.querySelector(".profile__pic-zone"),S=document.querySelector(".profile__pic"),b=document.querySelector(".profile__info"),q=document.querySelector(".profile__editbutton"),E=document.querySelector(".popup_type_edit"),L=document.forms["edit-form"],C=L.querySelector(".popup__input_type_name"),k=L.querySelector(".popup__input_type_job"),g=L.querySelector(".popup__savebutton"),x=document.querySelector(".elements"),A=document.querySelector(".profile__addbutton"),U=document.querySelector(".popup_type_add"),B=document.forms["add-form"],P=B.querySelector(".popup__input_type_title"),O=B.querySelector(".popup__input_type_link"),T=B.querySelector(".popup__savebutton"),j=document.querySelector(".popup_type_fullscreen"),w=document.querySelector(".popup__fullscreen-pic"),D=document.querySelector(".popup__fullscreen-subtitle"),N=document.querySelector(".popup_type_avatar"),J=document.forms["avatar-form"],M=J.querySelector(".popup__input_type_avatar"),z=J.querySelector(".popup__savebutton"),H=document.forms["delete-form"];function V(e,t){t.textContent=e?"Сохранение...":"Сохранить"}m.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&r(e),t.target.classList.contains("popup__closebutton")&&r(e)}))})),Promise.all([fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then(n).then((function(e){v.textContent=e.name,y.textContent=e.about,S.style.background="url(".concat(e.avatar,")"),b.dataset.id=e._id})).catch(f),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then(n).then((function(e){Array.from(e).forEach((function(e){var t=u(e,i,s,G);x.append(t)}))})).catch(f)]),J.addEventListener("submit",(function(e){e.preventDefault();var o,c=M.value;V(!0,z),(o=c,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:o})}).then(n)).then((function(){S.style.background="url(".concat(c,")"),r(N),J.reset()})).catch(f).finally((function(){V(!1,z)}))})),H.addEventListener("submit",(function(e){e.preventDefault();var o,c=H.dataset.id,u=document.querySelector('[data-id="'.concat(c,'"]'));(o=c,fetch("".concat(t.baseUrl,"/cards/").concat(o),{method:"DELETE",headers:t.headers}).then(n)).then((function(){u.remove(),r(a)})).catch(f)})),q.addEventListener("click",(function(){C.value=v.textContent,k.value=y.textContent,_(L,F),o(E)})),L.addEventListener("submit",(function(e){var o,c;e.preventDefault(),V(!0,g),(o=C.value,c=k.value,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:o,about:c})}).then(n)).then((function(e){v.textContent=e.name,y.textContent=e.about,r(E)})).catch(f).finally((function(){V(!1,g)}))})),A.addEventListener("click",(function(){o(U),_(B,F)})),B.addEventListener("submit",(function(e){e.preventDefault();var o,c,a=P.value,l=O.value;V(!0,T),(o=a,c=l,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:o,link:c})}).then(n)).then((function(e){var t=u(e,i,s,G);x.prepend(t),r(U)})).catch(f).finally((function(){V(!1,T)})),B.reset()})),h.addEventListener("click",(function(){o(N),_(J,F)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);p(n,o,t),e.addEventListener("reset",(function(){d(o,t)})),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?l(e,t,n):function(e,t,n,o){t.classList.add(n.inputErrorClass);var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=o,r.classList.add(n.errorClass)}(e,t,n,t.validationMessage)}(e,r,t),function(e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity("")}(r),p(n,o,t)}))}))}(t,e)}))}({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__savebutton",inactiveButtonClass:"popup__savebutton_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"});var F={inputSelector:".popup__input",submitButtonSelector:".popup__savebutton",inactiveButtonClass:"popup__savebutton_disabled",inputErrorClass:"popup__input_type_error"},G=function(e,t){o(j),w.src=e,D.textContent=t,w.alt=t}})();